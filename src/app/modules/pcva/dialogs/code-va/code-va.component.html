<div *ngIf="{
    vaRecord: vaRecord$ | async
} as params" class="overflow-hidden">
    <div class="mt-4 ml-4 flex justify-between items-center">
        <div>
            <span class="text-xl text-start">PCVA Coding Window </span>
        </div>
        <div class="mr-4">
            <mat-icon class="cursor-pointer" mat-dialog-close>close</mat-icon>
        </div>
    </div>
    <div class="grid grid-cols-12 p-2">
        <div class="col-span-6 pl-4 pr-4 pb-4 max-h-[800px] overflow-auto relative shadow-lg border m-1 pt-2">
            <div class="grid grid-cols-12 pt-2 pb-2 bg-white sticky top-[-17px] z-10">
                <div class=" col-span-8">
                    <span class="px-2 text-lg text-start">VA Details </span>
                </div>
                <div class="col-span-4">
                    <input type="text" name="searchText" [(ngModel)]="searchText" (ngModelChange)="onSearch()"
                        class="border-[1px] focus:border-[1px] pl-[10px] pr-[10px] focus:border-gray-400 border-gray-300 w-full h-[40px] rounded-[3px]"
                        id="searchText" placeholder="Search field">
                </div>
            </div>
            
            <table class="w-full divide-y divide-gray-200 table-auto">
                <thead class="bg-white sticky top-[0vh] z-10" *ngIf="params?.vaRecord?.data?.length && odkQuestions?.length">
                    <tr>
                        <th class="px-5 py-3 border-b-2 border-gray-200 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                           ID 
                        </th>
                        <th class="px-5 py-3 border-b-2 border-gray-200 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                            Label
                        </th>
                        <th class="px-5 py-3 border-b-2 border-gray-200 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                            Response
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <ng-container *ngIf="params?.vaRecord?.data?.length && displayQuestions?.length">
                        
                        <tr *ngFor="let question of displayQuestions; let i = index" [ngClass]="{ 'bg-gray-200': i % 2 !== 0 }">
                            @if(params?.vaRecord?.data[0][question?.key] && question?.key !== 'deviceid'){
                                <td class="px-5 py-3 border-b border-gray-200 text-sm ">
                                    <p class="text-gray-900 whitespace-no-wrap">{{ question?.key }}</p>
                                </td>
                                <td class="px-5 py-3 border-b border-gray-200 text-sm ">
                                    <p class="text-gray-900 whitespace-no-wrap">{{ question?.value?.label }}</p>
                                </td>
                                <td class="px-5 py-3 border-b border-gray-200 text-sm ">
                                    @if(question?.value?.options?.length === 0){
                                        <p class="text-gray-900 whitespace-no-wrap">{{ params?.vaRecord?.data[0][question?.key] }}</p>
                                    } @else {
                                        <ng-container *ngFor="let option of question?.value?.options;">
                                            @if(option.value === params?.vaRecord?.data[0][question?.key]){
                                                <p class="text-gray-900 whitespace-no-wrap">{{ option?.label }}</p>
                                            }
                                        </ng-container>
                                    }
                                </td>
                            }
                        </tr>
                    </ng-container>
                    
                </tbody>
            </table>
            @if(!odkQuestions?.length){
                <table class="table">
                    <tr class="w-full divide-y divide-gray-200 table-auto">
                        <td class="px-5 py-3 border-b border-gray-200 text-sm">
                            <p class="text-gray-900 whitespace-no-wrap text-center">Please, load ODK questions to be able to view this ODK</p>
                        </td>
                    </tr>
                </table>
            }
        </div>
        <div class="col-span-6 max-h-[800px] overflow-auto relative border px-4 m-1">
            <div class="pt-2 pb-2 sticky top-[-6vh] z-10">
                <div class="mt-2">
                    <span class="px-2 text-lg text-start">Coding Sheet </span>
                </div>
                <div class="mt-2">
                    <div class="flex items-center mb-4 gap-4">
                        <label class="block text-sm font-medium text-gray-500 w-1/4 px-2"> Coder's Name:</label>
                        <input type="text" disabled class="flex-1 p-2 border border-gray-300 rounded-md" name="coders_name"
                            placeholder="{{ data?.current_user?.name }}">
                    </div>
                </div>
                <div *ngIf="params?.vaRecord?.data?.length && data?.icdCodes && data?.fieldsMapping">
                    <app-coding-sheet
                        [icdCodes]="data?.icdCodes"
                        [settings]="data?.fieldsMapping"
                        [vaRecord]="params?.vaRecord?.data[0]"
                        [codedVA]="data?.codedData"
                        [messages]="data?.messages"
                        [allowChat]="data?.allowChat"
                        (save)="onSave($event)"
                    ></app-coding-sheet>
                </div>
            </div>
        </div>
    </div>
</div>