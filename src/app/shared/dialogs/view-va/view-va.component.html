<div *ngIf="{
    vaRecord: vaRecord$ | async
} as params" class="overflow-hidden">
    <div class="mt-4 ml-4 flex justify-between items-center">
        <div>
            <span class="text-2xl text-start">VA RECORD</span>
        </div>
        <div class="mr-4">
            <mat-icon class="cursor-pointer" (click)="onClose()">close</mat-icon>
        </div>
    </div>
    <div class="grid grid-cols-12">
        <div class="col-span-7 max-h-[800px] overflow-auto relative  p-4 border m-1">
            <div class="pt-2 pb-2 bg-white sticky top-[-17px] z-10">
                <span class="px-2 text-xl text-start">VA Details </span>
            </div>
            <table class="w-full divide-y divide-gray-200 table-auto">
                <thead *ngIf="params?.vaRecord?.data?.length && odkQuestions?.length">
                    <tr class="bg-white sticky top-6 z-10">
                        <th class="px-5 py-3 border-b-2 border-gray-200 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                           ID 
                        </th>
                        <th class="px-5 py-3 border-b-2 border-gray-200 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                            Label
                        </th>
                        <th class="px-5 py-3 border-b-2 border-gray-200 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                            Response
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <ng-container *ngIf="params?.vaRecord?.data?.length && odkQuestions?.length">
                        
                        <tr *ngFor="let question of odkQuestions; let i = index" [ngClass]="{ 'bg-gray-200': i % 2 !== 0 }">
                            @if(params?.vaRecord?.data[0][question?.key] && question?.key !== 'deviceid'){
                                <td class="px-5 py-3 border-b border-gray-200 text-sm ">
                                    <p class="text-gray-900 whitespace-no-wrap">{{ question?.key }}</p>
                                </td>
                                <td class="px-5 py-3 border-b border-gray-200 text-sm ">
                                    <p class="text-gray-900 whitespace-no-wrap">{{ question?.value?.label }}</p>
                                </td>
                                <td class="px-5 py-3 border-b border-gray-200 text-sm ">
                                    @if(question?.value?.options?.length === 0){
                                        <p class="text-gray-900 whitespace-no-wrap">{{ params?.vaRecord?.data[0][question?.key] }}</p>
                                    } @else {
                                        <ng-container *ngFor="let option of question?.value?.options;">
                                            @if(option.value === params?.vaRecord?.data[0][question?.key]){
                                                <p class="text-gray-900 whitespace-no-wrap">{{ option?.label }}</p>
                                            }
                                        </ng-container>
                                    }
                                </td>
                            }
                        </tr>
                    </ng-container>
                    
                </tbody>
            </table>
            @if(!odkQuestions?.length){
                <table class="table">
                    <tr class="w-full divide-y divide-gray-200 table-auto">
                        <td class="px-5 py-3 border-b border-gray-200 text-sm">
                            <p class="text-gray-900 whitespace-no-wrap text-center">Please, load ODK questions to be able to view this ODK</p>
                        </td>
                    </tr>
                </table>
            }
        </div>
        <div class="col-span-5 max-h-[800px] overflow-auto relative  p-4 border m-1">
            <div class="sticky top-0 z-10">
                <div class="mt-2 mb-2">
                    <span class="px-2 text-xl font-semibold text-start">VA Summary</span>
                </div>
                <div class="grid grid-cols-12 p-4 bg-gray-50 rounded-md overflow-auto"
                    *ngIf="params?.vaRecord?.data?.length && summaryInfo?.length ">
                    <ng-container *ngFor="let question of summaryInfo;">
                        <div *ngIf="params?.vaRecord?.data[0][question?.key]" class="summary-item col-span-4 mt-1 mb-1">
                            <strong class="text-gray-700">{{question?.value?.label ? question?.value?.label :
                                question?.key}}:</strong>
                        </div>
                        <div *ngIf="params?.vaRecord?.data[0][question?.key]" class="border border-gray-600 bg-gray-200 rounded-md p-4 mt-1 mb-1 col-span-8">
                            @if(question?.value?.options?.length === 0){
                            <p class="text-gray-900 whitespace-no-wrap">{{ params?.vaRecord?.data[0][question?.key] }}</p>
                            } @else {
                            <ng-container *ngFor="let option of question?.value?.options;">
                                @if(option.value === params?.vaRecord?.data[0][question?.key]){
                                <p class="text-gray-900 whitespace-no-wrap">{{ option?.label }}</p>
                                }
                            </ng-container>
                            }
                        </div>
                    </ng-container>
                </div>
            </div>
        </div>
    </div>

    <div class="absolute bottom-0 right-0 p-4">
        <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" (click)="onClose()">
            Close
        </button>
    </div>

</div>